{"version":3,"sources":["components/Map.module.css","components/res/placeholder.png","components/store/actions.ts","api/index.ts","components/MapSignForm.tsx","components/Sign.tsx","components/store/reducers.ts","components/Tip.tsx","components/Map.tsx","index.tsx"],"names":["module","exports","ACTION_TYPE","listMapSignsFromDB","a","fetch","process","res","json","console","error","message","addMapSignToDB","param","method","body","JSON","stringify","headers","setOpenedTip","openedTipState","type","SET_OPENED_TIP","updateAddedLocation","coordinates","UPDATE_ADDED_LOCATION","MapSignForm","location","children","dispatch","useDispatch","useForm","mode","handleSubmit","register","errors","className","styles","entryForm","onSubmit","value","sign","fromForm","image","entry","placeholder","ADD_ENTRY","name","ref","required","pattern","validate","str","length","title","rating","description","Sign","signEntry","zoom","args","_id","longitude","latitude","handleSetOpendTip","useCallback","entryOpenedState","useMemo","offsetLeft","offsetTop","onClick","signSVG","viewBox","style","width","height","fill","stroke","d","cx","cy","r","combineReducers","signs","state","entries","openedTips","addedCoordinates","action","INIT_ENTRIES","Tip","tip","closeButton","closeOnClick","anchor","captureScroll","sortByDepth","onClose","tipContent","entryDesc","Array","map","t","imageContainer","src","alt","Map","useState","maxZoom","minZoom","viewport","setViewport","currentMapInstance","useRef","handleInitEntries","useEffect","visibleEntries","useSelector","addedLocation","handleAddEntry","e","lngLat","handleDragAddEntry","handleCloseAddEntry","handleVisiable","info","viewState","mapStyle","mapboxApiAccessToken","doubleClickZoom","onDblClick","onViewStateChange","position","left","top","showCompass","key","uuid","draggable","onDrag","MapWrapper","store","createStore","reducers","applyMiddleware","thunk","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.19c5b932.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"sign\":\"Map_sign__3OxH1\",\"signSVG\":\"Map_signSVG__1pqra\",\"tipContent\":\"Map_tipContent__31dkD\",\"entryForm\":\"Map_entryForm__1L4D1\",\"entryDesc\":\"Map_entryDesc__zskcl\"};","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAIAAAAiOjnJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTEwMDk1OTdGOERFMTFFNEI1MjdFNkYwQUY5NzlEOEUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTEwMDk1OThGOERFMTFFNEI1MjdFNkYwQUY5NzlEOEUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozRDRCNENBQUY4Q0UxMUU0QjUyN0U2RjBBRjk3OUQ4RSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxMTAwOTU5NkY4REUxMUU0QjUyN0U2RjBBRjk3OUQ4RSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PiKpnkYAAAgtSURBVHja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\"","import { Dispatch } from 'redux';\nimport { addMapSignToDB, listMapSignsFromDB } from '../../api';\nimport { ICoordinates, IOpenedTips, ISignEntry } from '../../types';\n\nexport enum ACTION_TYPE {\n  INIT_ENTRIES,\n  ADD_ENTRY,\n  DELETE_ENTRY,\n  UPDATE_ENTRY,\n  SET_OPENED_TIP,\n  UPDATE_ADDED_LOCATION,\n}\n\nexport const initEntries = () => {\n  return async (dispatch: Dispatch) => {\n    const entries = await listMapSignsFromDB();\n    dispatch({ type: ACTION_TYPE.INIT_ENTRIES, entries });\n  };\n};\n\nexport const addEntry = (sign: ISignEntry) => {\n  return async (dispatch: Dispatch) => {\n    const entry = await addMapSignToDB(sign);\n\n    dispatch({ type: ACTION_TYPE.ADD_ENTRY, entry });\n  };\n};\n\nexport const setOpenedTip = (openedTipState: IOpenedTips) => {\n  return {\n    type: ACTION_TYPE.SET_OPENED_TIP,\n    openedTipState,\n  };\n};\n\n//\n\nexport const updateAddedLocation = (coordinates: ICoordinates | null) => {\n  return {\n    type: ACTION_TYPE.UPDATE_ADDED_LOCATION,\n    coordinates: coordinates || [],\n  };\n};\n","import { ISignEntry } from '../types';\n\nexport const listMapSignsFromDB = async () => {\n  try {\n    const res = await fetch(`${process.env.REACT_APP_API_URL}/api/signs`);\n    return res.json();\n  } catch (error) {\n    console.error(error.message);\n  }\n};\n\nexport const addMapSignToDB = async (param: ISignEntry) => {\n  try {\n    const res = await fetch(`${process.env.REACT_APP_API_URL}/api/signs`, {\n      method: 'POST',\n      body: JSON.stringify(param),\n      headers: {\n        'content-type': 'application/json',\n      },\n    });\n    return res.json();\n  } catch (error) {\n    console.error(error.message);\n  }\n};\n\nexport const getAtlas = async () => {\n  try {\n    const atlas = await fetch('https://geo.datav.aliyun.com/areas_v2/bound/450000.json');\n\n    return atlas.json();\n  } catch (error) {\n    console.error(error.message);\n  }\n};\n","import React, { FC } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useDispatch } from 'react-redux';\nimport { ISignEntry } from '../types';\nimport styles from './Map.module.css';\nimport placeholder from './res/placeholder.png';\nimport { addEntry, updateAddedLocation } from './store/actions';\n\nconst MapSignForm: FC<Partial<ISignEntry> & { editing?: boolean }> = ({\n  location = { type: 'Point', coordinates: [0, 0] },\n  children,\n}) => {\n  const dispatch = useDispatch();\n  const { handleSubmit, register, errors } = useForm({ mode: 'onChange' });\n\n  return (\n    <form\n      className={styles.entryForm}\n      onSubmit={handleSubmit((value) => {\n        const fromForm = value as ISignEntry;\n        const { image } = fromForm;\n\n        let entry = { ...fromForm, location };\n\n        if (!image) {\n          entry = { ...entry, image: placeholder };\n        }\n        dispatch(addEntry(entry));\n        dispatch(updateAddedLocation(null));\n      })}\n    >\n      <header>\n        <h3>添加标记</h3>\n      </header>\n      <main>\n        <input\n          placeholder=\"标题\"\n          name=\"title\"\n          ref={register({\n            required: '标题不能为空',\n            pattern: {\n              value: /(\\p{Unified_Ideograph}|[a-zA-Z0-9_ ])/u,\n              message: '仅接收字符数字空格和下划线',\n            },\n            validate: (str) => {\n              if (str.length > 48) {\n                return `标题最大接受48字符`;\n              }\n            },\n          })}\n        />\n        <div>{errors.title?.message}</div>\n        <input\n          placeholder=\"级别\"\n          name=\"rating\"\n          type=\"number\"\n          ref={register({\n            pattern: {\n              value: /^[1-5]$/,\n              message: '数字 1 - 5',\n            },\n          })}\n        />\n        <div>{errors.rating?.message}</div>\n        <input\n          placeholder=\"图片 URL\"\n          name=\"image\"\n          ref={register({\n            pattern: {\n              value: /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,\n              message: '无效的 URL',\n            },\n          })}\n        />\n        <div>{errors.image?.message}</div>\n        <textarea\n          placeholder=\"描述\"\n          name=\"description\"\n          ref={register({\n            validate: (str) => {\n              if (str.length > 512) {\n                return '描述最大接受512字符';\n              }\n            },\n          })}\n        />\n        <div>{errors.description?.message}</div>\n      </main>\n      <footer>\n        <span>{`${location!.coordinates[0]}, ${location!.coordinates[1]}`}</span>\n        <br />\n        <button type=\"submit\">Confirm</button>\n      </footer>\n      {children}\n    </form>\n  );\n};\n\nexport default MapSignForm;\n","import React, { FC, useCallback, useMemo } from 'react';\nimport { Marker, MarkerProps } from 'react-map-gl';\nimport { useDispatch } from 'react-redux';\nimport { ISignEntry } from '../types';\nimport styles from './Map.module.css';\nimport { setOpenedTip } from './store/actions';\n\ninterface ISignProps {\n  signEntry: ISignEntry;\n  type?: 'yellow' | 'red';\n  zoom: number;\n}\n\nconst Sign: FC<Partial<MarkerProps> & ISignProps> = ({\n  signEntry,\n  type = 'yellow',\n  zoom = 12,\n  ...args\n}) => {\n  const { location, _id } = signEntry;\n  const [longitude, latitude] = location.coordinates;\n\n  const dispatch = useDispatch();\n\n  const handleSetOpendTip = useCallback(\n    (entryOpenedState) => {\n      return () => {\n        dispatch(setOpenedTip(entryOpenedState));\n      };\n    },\n    [dispatch]\n  );\n\n  return useMemo(() => {\n    return (\n      <Marker\n        longitude={longitude}\n        latitude={latitude}\n        offsetLeft={-zoom}\n        offsetTop={-zoom * 2}\n        {...args}\n      >\n        <div className={styles.sign} onClick={handleSetOpendTip({ [_id!]: true })}>\n          <svg\n            className={styles.signSVG}\n            viewBox=\"0 0 24 24\"\n            style={{\n              width: `${zoom * 2}px`,\n              height: `${zoom * 2}px`,\n              fill: `${type === 'yellow' ? '#e6891e' : '#ff2200'}`,\n              stroke: 'white',\n            }}\n          >\n            <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\n            <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\n          </svg>\n        </div>\n      </Marker>\n    );\n  }, [_id, args, handleSetOpendTip, latitude, longitude, type, zoom]);\n};\n\nexport default Sign;\n","import { Action, combineReducers } from 'redux';\nimport { ICoordinates, IOpenedTips, ISignEntry } from '../../types';\nimport { ACTION_TYPE } from './actions';\n\ninterface IEntriesState {\n  entries: ISignEntry[];\n  openedTips: { [id: string]: string };\n  addedCoordinates: ICoordinates | [];\n}\n\nexport const signs = (\n  state: IEntriesState = {\n    entries: [],\n    openedTips: {},\n    addedCoordinates: [],\n  },\n  action: Action & {\n    entry: ISignEntry;\n    entries: ISignEntry[];\n    openedTipState: IOpenedTips;\n    coordinates: ICoordinates;\n  }\n) => {\n  switch (action.type) {\n    case ACTION_TYPE.INIT_ENTRIES:\n      return {\n        entries: action.entries ? [...action.entries] : [],\n        openedTips: state.openedTips,\n        addedCoordinates: state.addedCoordinates,\n      };\n\n    case ACTION_TYPE.SET_OPENED_TIP:\n      return {\n        entries: state.entries,\n        openedTips: { ...state.openedTips, ...action.openedTipState },\n        addedCoordinates: state.addedCoordinates,\n      };\n\n    case ACTION_TYPE.ADD_ENTRY:\n      return {\n        entries: [...state.entries, action.entry],\n        openedTips: state.openedTips,\n        addedCoordinates: state.addedCoordinates,\n      };\n\n    case ACTION_TYPE.UPDATE_ADDED_LOCATION:\n      return {\n        entries: state.entries,\n        openedTips: state.openedTips,\n        addedCoordinates: [...action.coordinates],\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport default combineReducers({ signs });\n","import React, { FC, useCallback, useMemo } from 'react';\nimport { Popup, PopupProps } from 'react-map-gl';\nimport { useDispatch } from 'react-redux';\nimport { ISignEntry } from '../types';\nimport styles from './Map.module.css';\nimport { setOpenedTip } from './store/actions';\n\ninterface ITipProps {\n  signEntry: ISignEntry;\n}\n\nconst Tip: FC<Partial<PopupProps> & ITipProps> = ({ signEntry, children, ...args }) => {\n  const { location, title, _id, description, image, rating } = signEntry;\n  const [longitude, latitude] = location.coordinates;\n\n  const dispatch = useDispatch();\n\n  const handleSetOpendTip = useCallback(\n    (action) => {\n      dispatch(setOpenedTip(action));\n    },\n    [dispatch]\n  );\n\n  return useMemo(() => {\n    return (\n      <Popup\n        className={styles.tip}\n        longitude={longitude}\n        latitude={latitude}\n        closeButton={true}\n        closeOnClick={false}\n        anchor=\"top\"\n        captureScroll={true}\n        sortByDepth={true}\n        onClose={() => {\n          handleSetOpendTip({ [_id!]: false });\n        }}\n        {...args}\n      >\n        <div className={styles.tipContent}>\n          {children || (\n            <div className={styles.entryDesc}>\n              <header>\n                <h3>{title}</h3>\n              </header>\n              <main>\n                {[...Array(rating)].map((t) => {\n                  return '⭐';\n                })}\n                <div className={styles.imageContainer}>\n                  <img src={image} alt=\"\" />\n                </div>\n                <article>{description}</article>\n              </main>\n              <footer>\n                <span>{`${longitude}, ${latitude}`}</span>\n              </footer>\n            </div>\n          )}\n        </div>\n      </Popup>\n    );\n  }, [\n    _id,\n    args,\n    children,\n    description,\n    handleSetOpendTip,\n    image,\n    latitude,\n    longitude,\n    rating,\n    title,\n  ]);\n};\n\nexport default Tip;\n","import 'mapbox-gl/dist/mapbox-gl.css';\nimport React, { Fragment, useCallback, useEffect, useRef, useState } from 'react';\nimport ReactMapGL, {\n  ContextViewStateChangeInfo,\n  DragEvent,\n  NavigationControl,\n  PointerEvent,\n  ViewportProps,\n} from 'react-map-gl';\nimport { Provider, RootStateOrAny, useDispatch, useSelector } from 'react-redux';\nimport { applyMiddleware, createStore } from 'redux';\nimport thunk from 'redux-thunk';\nimport { v5 as uuid } from 'uuid';\nimport { ICoordinates, ILocation, IOpenedTips, ISignEntry } from '../types';\nimport MapSignForm from './MapSignForm';\nimport Sign from './Sign';\nimport { initEntries, updateAddedLocation } from './store/actions';\nimport reducers from './store/reducers';\nimport Tip from './Tip';\n\nconst Map = () => {\n  const [viewport, setViewport] = useState<Partial<ViewportProps>>({\n    latitude: 22.828373068332063,\n    longitude: 108.30307218045874,\n    zoom: 12,\n    maxZoom: 15,\n    minZoom: 2,\n  });\n\n  const dispatch = useDispatch();\n\n  const currentMapInstance = useRef(null as any);\n\n  const handleInitEntries = useCallback(() => {\n    dispatch(initEntries());\n  }, [dispatch]);\n\n  useEffect(() => {\n    handleInitEntries();\n  }, [handleInitEntries]);\n\n  const visibleEntries: ISignEntry[] = useSelector((state: RootStateOrAny) => {\n    return state.signs.entries;\n  });\n\n  const openedTips: IOpenedTips = useSelector((state: RootStateOrAny) => {\n    return state.signs.openedTips;\n  });\n\n  const addedCoordinates: ICoordinates = useSelector((state: RootStateOrAny) => {\n    return state.signs.addedCoordinates;\n  });\n\n  const addedLocation: ILocation = {\n    type: 'Point',\n    coordinates: addedCoordinates,\n  };\n\n  const handleAddEntry = useCallback(\n    (e: PointerEvent) => {\n      dispatch(updateAddedLocation(e.lngLat));\n    },\n    [dispatch]\n  );\n\n  const handleDragAddEntry = useCallback(\n    (e: DragEvent) => {\n      dispatch(updateAddedLocation(e.lngLat));\n    },\n    [dispatch]\n  );\n\n  const handleCloseAddEntry = useCallback(() => {\n    dispatch(updateAddedLocation(null));\n  }, [dispatch]);\n\n  const handleVisiable = useCallback((info: ContextViewStateChangeInfo) => {\n    const { viewState } = info;\n    setViewport(viewState);\n  }, []);\n\n  const { zoom } = viewport;\n  return (\n    <ReactMapGL\n      ref={currentMapInstance}\n      width=\"100vw\"\n      height=\"100vh\"\n      {...viewport}\n      mapStyle={process.env.REACT_APP_MAP_STYLE}\n      mapboxApiAccessToken={process.env.REACT_APP_MAPBOX_TOKEN} // edit it at .env file in *client* root directory.\n      doubleClickZoom={false}\n      onDblClick={handleAddEntry}\n      onViewStateChange={handleVisiable}\n    >\n      <div style={{ position: 'absolute', left: 10, top: 10 }}>\n        <NavigationControl showCompass={true} />\n      </div>\n\n      {visibleEntries.map((entry) => {\n        const { _id } = entry;\n        const key = uuid(entry._id || '', '63d601b1-3193-475e-9d1e-ccb1fd077784');\n\n        return (\n          <Fragment key={key + '_fragment'}>\n            <Sign signEntry={entry} key={key + '_sign'} zoom={zoom!} />\n            {openedTips[_id!] && <Tip signEntry={entry} key={key + '_tip'} />}\n          </Fragment>\n        );\n      })}\n\n      {addedCoordinates.length === 2 && (\n        <>\n          <Sign\n            signEntry={{\n              title: '',\n              location: addedLocation,\n            }}\n            type=\"red\"\n            draggable={true}\n            onDrag={handleDragAddEntry}\n            zoom={zoom!}\n          />\n          <Tip\n            signEntry={{\n              title: '',\n              location: addedLocation,\n            }}\n            onClose={handleCloseAddEntry}\n          >\n            <MapSignForm location={addedLocation} />\n          </Tip>\n        </>\n      )}\n    </ReactMapGL>\n  );\n};\n\nconst MapWrapper = () => {\n  const store = createStore(reducers, applyMiddleware(thunk));\n  return (\n    <Provider store={store}>\n      <Map />\n    </Provider>\n  );\n};\n\nexport default MapWrapper;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Map from './components/Map';\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Map />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}